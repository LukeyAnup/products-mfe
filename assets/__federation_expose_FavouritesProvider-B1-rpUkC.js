import{importShared as g}from"./__federation_fn_import-eoakS9EZ.js";import{r as y,A as u,_ as A}from"./responseHandler-DkRXjDjr.js";import{j as _}from"./jsx-runtime-BjG_zV1W.js";const d="http://localhost:4000/users",j=async o=>y(async()=>{const e=await fetch(`${d}/${o}`);if(!e.ok)throw new u("Failed to fetch favourites");return{data:(await e.json()).favourites||[],statusCode:200,message:"Favourites fetched successfully"}}),x=async(o,e)=>y(async()=>{const a=await fetch(`${d}/${o}`);if(!a.ok)throw new u("Failed to fetch user data");const i=(await a.json()).favourites||[];if(i.some(w=>w.productId===e))throw new u("Already in favourites");const s={id:Date.now(),productId:e,addedAt:new Date().toISOString()},v=[...i,s],n=await fetch(`${d}/${o}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({favourites:v})});if(!n.ok)throw new u("Failed to add to favourites");return{data:await n.json(),statusCode:200,message:"Added to favourites successfully"}}),C=async(o,e)=>y(async()=>{const a=await fetch(`${d}/${o}`);if(!a.ok)throw new u("Failed to fetch user data");const f=((await a.json()).favourites||[]).filter(n=>n.productId!==e),s=await fetch(`${d}/${o}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({favourites:f})});if(!s.ok)throw new u("Failed to remove from favourites");return{data:await s.json(),statusCode:200,message:"Removed from favourites successfully"}}),{createContext:E,useContext:$,useState:F,useEffect:P}=await g("react"),R=await A("authMFE","./AuthProvider");let{useAuth:S}=R;const m=E(void 0),H=({children:o})=>{const{user:e,isAuthenticated:a}=S(),[c,i]=F([]),[f,s]=F(!1);P(()=>{a&&e?.id?v():i([])},[e?.id,a]);const v=async()=>{if(e?.id){s(!0);try{const t=await j(e.id);if(t.status&&t.data){const r=t.data.map(h=>h.productId);i(r)}}catch(t){console.error("Failed to load favourites:",t)}finally{s(!1)}}},n=async t=>{if(!e?.id)throw new Error("Please login to add favourites");s(!0);try{await x(e.id,t),i(r=>[...r,t])}catch(r){console.error(r)}finally{s(!1)}},l=async t=>{if(e?.id){s(!0);try{await C(e.id,t),i(r=>r.filter(h=>h!==t))}catch(r){console.error(r)}finally{s(!1)}}},w=async t=>{c.includes(t)?await l(t):await n(t)},p=t=>c.includes(t);return _.jsx(m.Provider,{value:{favourites:c,addFavourite:n,removeFavourite:l,toggleFavourite:w,isFavourite:p,loading:f},children:o})},O=()=>{const o=$(m);if(!o)throw new Error("useFavourites must be used within FavouritesProvider");return o};export{H as FavouritesProvider,O as useFavourites};
