import{importShared as j}from"./__federation_fn_import-eoakS9EZ.js";import{_ as T,A as E}from"./responseHandler-DkRXjDjr.js";import{j as e}from"./jsx-runtime-BjG_zV1W.js";/* empty css              */import{u as _,e as $,i as A,c as q,M as O,g as W,R as U,r as L,a as z}from"./cartApi-CZCZ8ZOH.js";import{k as D,l as V,g as H,b as B,u as G,d as P,e as J,s as Q,m as K,j as X,n as Y,T as Z,o as ee,B as v,f as te,L as se,E as ae}from"./error-BJAHachG.js";import{I as re,B as oe,b as ne,c as ie}from"./buttonIcon-C4Z3xCn-.js";import{I as le}from"./image-DmEqM-8I.js";import{c as ce}from"./checkoutApi-CdL_HDGU.js";import{c as S}from"./clsx-B-dksMZM.js";const de=await j("react");function ue(s={}){const{themeId:t,defaultTheme:r,defaultClassName:i="MuiBox-root",generateClassName:l}=s,p=D("div",{shouldForwardProp:o=>o!=="theme"&&o!=="sx"&&o!=="as"})(V);return de.forwardRef(function(h,c){const d=_(r),{className:m,component:y="div",...a}=$(h);return e.jsx(p,{as:y,ref:c,className:S(m,l?l(i):i),theme:t&&d[t]||d,...a})})}function pe(s){return H("MuiTypography",s)}B("MuiTypography",["root","h1","h2","h3","h4","h5","h6","subtitle1","subtitle2","body1","body2","inherit","button","caption","overline","alignLeft","alignRight","alignCenter","alignJustify","noWrap","gutterBottom","paragraph"]);const he=await j("react"),xe={primary:!0,secondary:!0,error:!0,info:!0,success:!0,warning:!0,textPrimary:!0,textSecondary:!0,textDisabled:!0},me=A(),fe=s=>{const{align:t,gutterBottom:r,noWrap:i,paragraph:l,variant:p,classes:x}=s,o={root:["root",p,s.align!=="inherit"&&`align${P(t)}`,r&&"gutterBottom",i&&"noWrap",l&&"paragraph"]};return J(o,pe,x)},ge=Q("span",{name:"MuiTypography",slot:"Root",overridesResolver:(s,t)=>{const{ownerState:r}=s;return[t.root,r.variant&&t[r.variant],r.align!=="inherit"&&t[`align${P(r.align)}`],r.noWrap&&t.noWrap,r.gutterBottom&&t.gutterBottom,r.paragraph&&t.paragraph]}})(K(({theme:s})=>({margin:0,variants:[{props:{variant:"inherit"},style:{font:"inherit",lineHeight:"inherit",letterSpacing:"inherit"}},...Object.entries(s.typography).filter(([t,r])=>t!=="inherit"&&r&&typeof r=="object").map(([t,r])=>({props:{variant:t},style:r})),...Object.entries(s.palette).filter(X()).map(([t])=>({props:{color:t},style:{color:(s.vars||s).palette[t].main}})),...Object.entries(s.palette?.text||{}).filter(([,t])=>typeof t=="string").map(([t])=>({props:{color:`text${P(t)}`},style:{color:(s.vars||s).palette.text[t]}})),{props:({ownerState:t})=>t.align!=="inherit",style:{textAlign:"var(--Typography-textAlign)"}},{props:({ownerState:t})=>t.noWrap,style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}},{props:({ownerState:t})=>t.gutterBottom,style:{marginBottom:"0.35em"}},{props:({ownerState:t})=>t.paragraph,style:{marginBottom:16}}]}))),k={h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",subtitle1:"h6",subtitle2:"h6",body1:"p",body2:"p",inherit:"p"},ye=he.forwardRef(function(t,r){const{color:i,...l}=G({props:t,name:"MuiTypography"}),p=!xe[i],x=me({...l,...p&&{color:i}}),{align:o="inherit",className:h,component:c,gutterBottom:d=!1,noWrap:m=!1,paragraph:y=!1,variant:a="body1",variantMapping:n=k,...u}=x,f={...x,align:o,color:i,className:h,component:c,gutterBottom:d,noWrap:m,paragraph:y,variant:a,variantMapping:n},g=c||(y?"p":n[a]||k[a])||"span",I=fe(f);return e.jsx(ge,{as:g,ref:r,className:S(I.root,h),...u,ownerState:f,style:{...o!=="inherit"&&{"--Typography-textAlign":o},...u.style}})}),je=B("MuiBox",["root"]),be=ee(),w=ue({themeId:Z,defaultTheme:be,defaultClassName:je.root,generateClassName:Y.generate}),F=q(e.jsx("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close");function ve({open:s,onClose:t,title:r,children:i,width:l=400}){return e.jsx(O,{open:s,onClose:t,children:e.jsxs(w,{sx:we(l),children:[r&&e.jsxs(w,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(ye,{variant:"h6",children:r}),e.jsx(re,{onClick:t,children:e.jsx(F,{})})]}),e.jsx(w,{mt:2,children:i})]})})}const we=s=>({position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:s,bgcolor:"background.paper",borderRadius:2,boxShadow:24,px:2}),{useState:M}=await j("react"),{toast:N}=await j("react-toastify"),Ne=await T("authMFE","./AuthProvider");let{useAuth:Ce}=Ne;function Pe(s){const{user:t}=Ce(),[r,i]=M(!1),[l,p]=M(!1);function x(){i(!0)}function o(){i(!1)}const h=async()=>{if(!t?.id){N.error("Please login to checkout");return}p(!0);try{const c=s.cartProducts.map(m=>({id:m.cartId,productId:m.id,quantity:m.quantity})),d=await ce(t.id,c);if(!d.status)throw new E(d.message);N.success("Checkout successful!"),o(),setTimeout(()=>{window.location.reload()},1e3)}catch(c){console.error(c);const d=c instanceof Error?c.message:"Checkout failed";N.error(d)}finally{p(!1)}};return e.jsxs("div",{children:[e.jsxs(ve,{open:r,onClose:o,children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("h3",{className:"text-xl font-bold mb-3",children:"Checkout Modal"}),e.jsx(F,{onClick:o,className:"cursor-pointer"})]}),e.jsxs("div",{className:"bg-white px-2 py-3 rounded-xl shadow-sm sticky top-4",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Order Summary"}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:["Items (",s.cartProducts.length,")"]}),e.jsxs("span",{children:["$",s.totalPrice.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Shipping"}),e.jsx("span",{className:"text-green-600",children:"Free"})]}),e.jsx("div",{className:"border-t pt-2 mt-2",children:e.jsxs("div",{className:"flex justify-between font-bold text-lg",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["$",s.totalPrice.toFixed(2)]})]})})]})]}),e.jsxs("div",{className:"flex justify-between py-2 gap-3",children:[e.jsx(v,{variant:"outlined",text:"Cancel",className:"w-full",onClick:o,disabled:l}),e.jsx(v,{text:"Checkout",className:"w-full",onClick:h,disabled:l})]})]}),e.jsx(v,{text:"Proceed to Checkout",className:"w-full",onClick:x})]})}const{toast:b}=await j("react-toastify"),{useState:C,useEffect:Ie}=await j("react"),ke=await T("authMFE","./AuthProvider");let{useAuth:Me}=ke;const{useTranslation:Te}=await j("react-i18next");function We(){const{t:s}=Te(),{user:t,isAuthenticated:r}=Me(),[i,l]=C(!0),[p,x]=C(null),[o,h]=C([]);Ie(()=>{r&&t?c():(l(!1),h([]))},[t,r]);const c=async()=>{if(t?.id)try{l(!0);const[a,n]=await Promise.all([W(t.id),te()]);if(!a.status||!a.data){x(a.message||"Unknown error");return}const f=a.data.map(g=>({...n.find(R=>R.id===g.productId),cartId:g.id,quantity:g.quantity}));h(f),x(null)}catch(a){console.error(a),b.error("Failed to load cart")}finally{l(!1)}};async function d(a){if(t?.id)try{const n=await L(t.id,a);h(u=>u.filter(f=>f.cartId!==a)),b.success(n.message||s("products.cart.removed"))}catch(n){const u=n instanceof Error?n.message:"Failed to remove item";b.error(u)}}async function m(a,n){if(!(n<1||!t?.id))try{const u=await z(t.id,a,n);h(f=>f.map(g=>g.cartId===a?{...g,quantity:n}:g)),b.success(u.message??"Quantity updated")}catch(u){const f=u instanceof Error?u.message:"Failed to update quantity";b.error(f)}}const y=o.reduce((a,n)=>a+n.price*n.quantity,0);return r?i?e.jsx(se,{}):p?e.jsx(ae,{message:p??"Unknown error",onRetry:()=>window.location.reload()}):o.length===0?e.jsxs("div",{className:"flex flex-col justify-center items-center min-h-screen gap-4",children:[e.jsx("h2",{className:"text-2xl font-bold",children:s("products.cart.emptyCart")}),e.jsx("p",{className:"text-gray-600",children:s("products.cart.addProductToCart")})]}):e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("h2",{className:"text-3xl font-bold mb-6",children:[s("products.cart.shoppingCart")," (",o.length," ",o.length===1?"item":"items",")"]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2 space-y-4",children:o.map(a=>e.jsxs("div",{className:"bg-white p-6 flex flex-col md:flex-row gap-4 rounded-2xl shadow-md transition-all duration-300 hover:shadow-lg",children:[e.jsx("div",{className:"w-full md:w-32 h-32 shrink-0",children:e.jsx(le,{loading:"lazy",alt:a.title,src:a.images?.[0],className:"w-full h-full object-contain"})}),e.jsxs("div",{className:"flex-1 flex flex-col gap-2",children:[e.jsx("p",{className:"font-bold text-lg",children:a.title}),e.jsx(U,{max:5,readOnly:!0,size:"small",precision:.1,value:a.rating??0}),e.jsx("p",{className:"line-clamp-2 text-gray-600 text-sm",children:a.description}),e.jsx("div",{className:"flex items-center gap-2 mt-2",children:e.jsxs("p",{className:"font-semibold text-xl",children:["$",a.price]})}),e.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[e.jsx(oe,{onClick:()=>m(a.cartId,a.quantity-1),disabled:a.quantity<=1,className:"w-8 h-8 rounded-full bg-gray-200 hover:bg-gray-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center font-bold",children:e.jsx(ne,{})}),e.jsx("span",{className:"font-semibold min-w-8 text-center",children:a.quantity}),e.jsx("button",{onClick:()=>m(a.cartId,a.quantity+1),className:"w-8 h-8 rounded-full bg-gray-200 hover:bg-gray-300 cursor-pointer flex items-center justify-center font-bold",children:e.jsx(ie,{})})]}),e.jsxs("p",{className:"font-bold text-lg mt-2",children:[s("products.cart.subTotal"),(a.price*a.quantity).toFixed(2)]})]}),e.jsx("div",{className:"flex md:flex-col justify-end items-end",children:e.jsx(v,{variant:"outlined",text:"Remove",onClick:()=>d(a.cartId),className:"text-red-600 hover:text-red-800 font-semibold"})})]},a.cartId))}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-md sticky top-4",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:s("products.cart.orderSummary")}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:[s("products.cart.items")," (",o.length,")"]}),e.jsxs("span",{children:["$",y.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:[" ",s("products.cart.shipping")]}),e.jsx("span",{className:"text-green-600",children:s("products.cart.free")})]}),e.jsx("div",{className:"border-t pt-2 mt-2",children:e.jsxs("div",{className:"flex justify-between font-bold text-lg",children:[e.jsxs("span",{children:[" ",s("products.cart.total")]}),e.jsxs("span",{children:["$",y.toFixed(2)]})]})})]}),e.jsx(Pe,{totalPrice:y,cartProducts:o})]})})]})]}):e.jsx("div",{className:"flex flex-col justify-center items-center min-h-screen gap-4",children:e.jsx("h2",{className:"text-2xl font-bold",children:s("products.cart.loginToViewCart")})})}export{We as default};
